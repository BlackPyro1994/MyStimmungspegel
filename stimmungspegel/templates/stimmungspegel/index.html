{% extends "stimmungspegel/base.html" %}

{% block content %}
<div class="row">
  <!-- Map -->
  <div class="col-xs-12 col-md-6">
    <div class="map" id="map-canvas"></div>
  </div>


  <!-- Top Ten oder so... -->
  <div class="col-xs-12 col-md-6">
    <h4> Beste Stimmung im Umkreis von <span id="radius">...</span>:</h4>
    <div id="location_list">
      <div class="text-center" style="font-size: 35px"><br><i class="fa fa-spinner fa-pulse"></i></div>  
    </div>
  </div>
</div>
{% endblock %}

{% block jquery %}
<script>
  $(document).ready(function () {

    function byRating(a, b) {
        if(a.rating < b.rating) return 1;
        else if (a.rating > b.rating) return -1;
        return 0;
    }

    function byBeerPrice(a, b) {
        if(a.beer_price > b.beer_price) return 1;
        else if (a.beer_price < b.beer_price) return -1;
        return 0;
    }

    $.ajax({
      type: "POST",
      url: "{% url 'getlocations' %}",
      dataType: "json",
      data: {
        lat: 50.938361,
        lon: 6.959974,
        radius: 10.0
      }
    })
    .done(function(locations) {
      $("#radius").html("10km");
      $("#location_list").empty();
      
      locations.sort(byRating);
      
      locations.forEach(function(location, index, array) {
        var rating_html = '';
        for (var i = 0; i < location.rating.toFixed(); i++) {
          rating_html = rating_html + "<i class=\"fa fa-star\"></i>";
        }
        for (var i = 0; i < 5 - location.rating.toFixed(); i++) {
          rating_html = rating_html + "<i class=\"fa fa-star-o\"></i>"; 
        }
        $("#location_list").append(
          '<div class="location well well-sm"' +
          '<p><b><a href="/detail/' + location.id + '">' + location.name + '</a></b></p>' +
          '<p>Stimmung: ' + rating_html + '</p>' +
          '<p>Bierpreis: ' + location.beer_price + 'â‚¬</p>' +
          '</div>'
        );
      });
    })
    .fail(function(xhr, status, errorThrown) {
      console.log("Error: " + errorThrown);
      console.log("Status: " + status);
      $("#location_list").empty();
      $("#location_list").html("<p><i>Irgendetwas ist schief gelaufen&hellip; Sorry.</i></p>");
    });
  });
</script>
{% endblock %}
